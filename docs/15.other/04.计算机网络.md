---
title: 计算机网络
date: 2022-09-26 18:00:23
permalink: /other/computernetwork/
categories: 
  - other
tags: 
  - 
---
## 网络层次划分
开放系统互联参考模型，即OSI/RM模型(Open System Interconnection/Reference Model)。它将计算机网络体系结构的通信协议划分为七层，自下而上依次为:  
&emsp;物理层(Physics Layer)  
&emsp;数据链路层(Data Link Layer)  
&emsp;网络层(Network Layer)  
&emsp;传输层(Transport Layer)  
&emsp;会话层(Session Layer)  
&emsp;表示层(Presentation Layer)  
&emsp;应用层(Application Layer)  
其中第四层完成数据传送服务，上面三层面向用户。 
### OSI模型:
1. 物理层(Physical Layer)  
&emsp;激活、维持、关闭通信端点之间的机械特性、电气特性、功能特性以及过程特性。该层为上层协议提供了一个传输数据的可靠的物理媒体。简单的说，物理层确保原始的数据可在各种物理媒体上传输。物理层记住两个重要的设备名称，中继器(Repeater，也叫放大器)和集线器。
2. 数据链路层(Data Link Layer)  
&emsp;数据链路层在物理层提供的服务的基础上向网络层提供服务，其最基本的服务是将源自网络层来的数据可靠地传输到相邻节点的目标机网络层。为达到这一目的，数据链路必须具备一系列相应的功能，主要有：如何将数据组合成数据块，在数据链路层中称这种数据块为帧(frame),帧是数据链路层的传送单位；如何控制帧在物理信道上的传输，包括如何处理传输差错，如何调节发送速率以使与接收方相匹配；以及在两个网络实体之间提供数据链路通路的建立、维持和释放的管理。数据链路层在不可靠的物理介质上提供可靠的传输。该层的作用包括：物理地址寻址、数据的成帧、流量控制、数据的检错、重发等。  
&emsp;数据链路层为网络层提供可靠的数据传输,基本数据单位为帧。  
&emsp;主要的协议：以太网协议；两个重要设备名称：网桥和交换机。  
3. 网络层(Network Layer)  
&emsp;网络层的目的是实现两个端系统之间的数据透明传送，具体功能包括寻址和路由选择、连接的建立、保持和终止等。它提供的服务使传输层不需要了解网络中的数据传输和交换技术。如果您想用尽量少的词来记住网络层，那就是"路径选择、路由及逻辑寻址"。  
&emsp;网络层中涉及众多的协议，其中包括最重要的协议，也是TCP/IP的核心协议——IP协议。IP协议非常简单，仅仅提供不可靠、无连接的传送服务。IP协议的主要功能有：无连接数据报传输、数据报路由选择和差错控制。与IP协议配套使用实现其功能的还有地址解析协议ARP、逆地址解析协议RARP、因特网报文协议ICMP、因特网组管理协议IGMP。重要的设备：路由器。  
&emsp;网络层负责对子网间的数据包进行路由选择。此外，网络层还可以实现拥塞控制、网际互连等功能；基本数据单位为IP数据报。包含的主要协议：  
&emsp;&emsp;IP协议(Internet Protocol，因特网互联协议);  
&emsp;&emsp;ICMP协议(Internet Control Message Protocol，因特网控制报文协议);  
&emsp;&emsp;ARP协议(Address Resolution Protocol，地址解析协议);  
&emsp;&emsp;RARP协议(Reverse Address Resolution Protocol，逆地址解析协议)。
4. 传输层(Transport Layer)  
&emsp;第一个端到端，即主机到主机的层次。传输层负责将上层数据分段并提供端到端的、可靠的或不可靠的传输。此外，传输层还要处理端到端的差错控制和流量控制问题。 传输层的任务是根据通信子网的特性，最佳的利用网络资源，为两个端系统的会话层之间，提供建立、维护和取消传输连接的功能，负责端到端的可靠数据传输。在这一层，信息传送的协议数据单元称为段或报文。 网络层只是根据网络地址将源结点发出的数据包传送到目的结点，而传输层则负责将数据可靠地传送到相应的端口。  
&emsp;传输层负责将上层数据分段并提供端到端的、可靠的或不可靠的传输以及端到端的差错控制和流量控制问题。
&emsp;包含的主要协议：TCP协议(Transmission Control Protocol，传输控制协议)、UDP协议(User Datagram Protocol，用户数据报协议)，重要设备：网关。
5. 会话层
&emsp;会话层管理主机之间的会话进程，即负责建立、管理、终止进程之间的会话。会话层还利用在数据中插入校验点来实现数据的同步。
6. 表示层
&emsp;表示层对上层数据或信息进行变换以保证一个主机应用层信息可以被另一个主机的应用程序理解。表示层的数据转换包括数据的加密、压缩、格式转换等。
7. 应用层
&emsp;为操作系统或网络应用程序提供访问网络服务的接口。  
&emsp;数据传输基本单位为报文。  
&emsp;包含的主要协议：FTP(文件传送协议)、Telnet(远程登录协议)、DNS(域名解析协议)、SMTP(邮件传送协议)，POP3协议(邮局协议)，HTTP协议(Hyper Text Transfer Protocol)。
## IP地址
**网络地址**  
IP地址由网络号(包括子网号)和主机号组成，网络地址的主机号为全0，网络地址代表着整个网络。  
**广播地址**  
广播地址通常称为直接广播地址，是为了区分受限广播地址。  
广播地址与网络地址的主机号正好相反，广播地址中，主机号为全1。当向某个网络的广播地址发送消息时，该网络内的所有主机都能收到该广播消息。  
**子网掩码**  
子网掩码是标志两个IP地址是否同属于一个子网的，也是32位二进制地址，其每一个为1代表该位是网络位，为0代表主机位。它和IP地址一样也是使用点式十进制来表示的。如果两个IP地址在子网掩码的按位与的计算下所得结果相同，即表明它们共属于同一子网中。  
在计算子网掩码时，我们要注意IP地址中的保留地址，即" 0"地址和广播地址，它们是指主机地址或网络地址全为" 0"或" 1"时的IP地址，它们代表着本网络地址和广播地址，一般是不能被计算在内的。
## TCP/IP协议
&emsp;TCP/IP协议是Internet最基本的协议、Internet国际互联网络的基础，由网络层的IP协议和传输层的TCP协议组成。通俗而言：TCP负责发现传输的问题，一有问题就发出信号，要求重新传输，直到所有数据安全正确地传输到目的地。而IP是给因特网的每一台联网设备规定一个地址。  
&emsp;TCP连接建立过程：首先Client端发送连接请求报文，Server段接受连接后回复ACK报文，并为这次连接分配资源。Client端接收到ACK报文后也向Server段发生ACK报文，并分配资源，这样TCP连接就建立了。  
&emsp;TCP连接断开过程：假设Client端发起中断连接请求，也就是发送FIN报文。Server端接到FIN报文后，意思是说"我Client端没有数据要发给你了"，但是如果你还有数据没有发送完成，则不必急着关闭Socket，可以继续发送数据。所以你先发送ACK，"告诉Client端，你的请求我收到了，但是我还没准备好，请继续你等我的消息"。这个时候Client端就进入FIN_WAIT状态，继续等待Server端的FIN报文。当Server端确定数据已发送完成，则向Client端发送FIN报文，"告诉Client端，好了，我这边数据发完了，准备好关闭连接了"。Client端收到FIN报文后，"就知道可以关闭连接了，但是他还是不相信网络，怕Server端不知道要关闭，所以发送ACK后进入TIME_WAIT状态，如果Server端没有收到ACK则可以重传。"，Server端收到ACK后，"就知道可以断开连接了"。Client端等待了2MSL后依然没有收到回复，则证明Server端已正常关闭，那好，我Client端也可以关闭连接了。Ok，TCP连接就这样关闭了！
## UDP协议
&emsp;UDP用户数据报协议，是面向无连接的通讯协议，UDP数据包括目的端口号和源端口号信息，由于通讯不需要连接，所以可以实现广播发送。  
&emsp;UDP通讯时不需要接收方确认，属于不可靠的传输，可能会出现丢包现象，实际应用中要求程序员编程验证。  
&emsp;UDP与TCP位于同一层，但它不管数据包的顺序、错误或重发。因此，UDP不被应用于那些使用虚电路的面向连接的服务，UDP主要用于那些面向查询---应答的服务，例如NFS。相对于FTP或Telnet，这些服务需要交换的信息量较小。  
&emsp;每个UDP报文分UDP报头和UDP数据区两部分。报头由四个16位长(2字节)字段组成，分别说明该报文的源端口、目的端口、报文长度以及校验值。UDP报头由4个域组成，其中每个域各占用2个字节，具体如下：源端口号；目标端口号；数据报长度；校验值。  
&emsp;使用UDP协议包括：TFTP(简单文件传输协议)、SNMP(简单网络管理协议)、DNS(域名解析协议)、NFS、BOOTP。  
&emsp;TCP 与 UDP 的区别：TCP是面向连接的，可靠的字节流服务；UDP是面向无连接的，不可靠的数据报服务。
## HTTP协议
超文本传输协议(HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议。端口号80。  
### 请求头
**Connection：** 连接状态，如keep-alive, close  
**Accept：** 通知服务器自己可接受的媒体类型  
**Accept-Charset：** 客户端可接受的字符集  
**Accept-Encoding：** 客户端可接受编码格式，如gzip  
**Accept-Language：** 客户端可接受的语言  
**Host：** 请求的服务器名称和端口号  
**Referer：** 跳转至当前URI的前一个URL  
**User-Agent：** 客户端代理，浏览器版本  
**Authorization：** 向服务器发送认证信息，如账号和密码  
**Cookie：** 客户端向服务器发送cookie  
**Allow：** 列出对此资源实体可使用的请求方法  
**Location：** 告诉客户端真正的实体位于何处  
**Content-Encoding：** 对主体执行的编码  
**Content-Language：** 理解主体时最适合的语言  
**Content-Length：** 主体的长度  
**Content-Location：** 实体真正所处位置  
**Content-Type：** 主体的对象类型，如text
### 状态码
**200 OK：** 表示从客户端发送给服务器的请求被正常处理并返回。  
**204 No Content：** 表示客户端发送给客户端的请求得到了成功处理，但在返回的响应报文中不含实体的主体部分(没有资源可以返回)。  
**206 Patial Content：** 表示客户端进行了范围请求，并且服务器成功执行了这部分的GET请求，响应报文中包含由Content-Range指定范围的实体内容。  
**301 Moved Permanently：** 永久性重定向，表示请求的资源被分配了新的URL，之后应使用更改的URL。  
**302 Found：** 临时性重定向，表示请求的资源被分配了新的URL，希望本次访问使用新的URL。  
**303 See Other：** 表示请求的资源被分配了新的URL，应使用GET方法定向获取请求的资源。  
**304 Not Modified：** 表示客户端发送附带条件(是指采用GET方法的请求报文中包含if-Match、If-Modified-Since、If-None-Match、If-Range、If-Unmodified-Since中任一首部)的请求时，服务器端允许访问资源，但是请求为满足条件的情况下返回改状态码。  
**307 Temporary Redirect：** 临时重定向，与303有着相同的含义，307会遵照浏览器标准不会从POST变成GET；(不同浏览器可能会出现不同的情况)。  
**400 Bad Request：** 表示请求报文中存在语法错误。  
**401 Unauthorized：** 未经许可，需要通过HTTP认证。  
**403 Forbidden：** 服务器拒绝该次访问(访问权限出现问题)。  
**404 Not Found：** 表示服务器上无法找到请求的资源，除此之外，也可以在服务器拒绝请求但不想给拒绝原因时使用。  
**500 Inter Server Error：** 表示服务器在执行请求时发生了错误，也有可能是web应用存在的bug或某些临时的错误时。  
**503 Server Unavailable：** 表示服务器暂时处于超负载或正在进行停机维护，无法处理请求。
### get, post, put, delete
&emsp;GET请求会向数据库发索取数据的请求，从而来获取信息，该请求就像数据库的select操作一样，只是用来查询一下数据，不会修改、增加数据，不会影响资源的内容，即该请求不会产生副作用。无论进行多少次操作，结果都是一样的。  
&emsp;与GET不同的是，PUT请求是向服务器端发送数据的，从而改变信息，该请求就像数据库的update操作一样，用来修改数据的内容，但是不会增加数据的种类等，也就是说无论进行多少次PUT操作，其结果并没有不同。  
&emsp;POST请求同PUT请求类似，都是向服务器端发送数据的，但是该请求会改变数据的种类等资源，就像数据库的insert操作一样，会创建新的内容。几乎目前所有的提交操作都是用POST请求的。  
&emsp;DELETE请求顾名思义，就是用来删除某一个资源的，该请求就像数据库的delete操作。
### http1.1/http2.0
**HTTP1.1:**  
&emsp;长链接:Pipeling解决方式为，若干个请求排队串行化单线程处理，后面的请求等待前面请求的返回才能获得执行机会，一旦有某请求超时等，后续请求只能被阻塞，毫无办法，也就是人们常说的线头阻塞；长链接上限100个请求。  
**HTTP2:**  
&emsp;多路复用:多个请求可同时在一个连接上并行执行。某个请求任务耗时严重，不会影响到其它连接的正常执行。  
&emsp;header压缩:使用encoder来减少需要传输的header大小，通讯双方各自cache一份header fields表，既避免了重复header的传输，又减小了需要传输的大小。  
服务端推送(server push):采用了SPDY的网页，例如我的网页有一个sytle.css的请求，在客户端收到sytle.css数据的同时，服务端会将sytle.js的文件推送给客户端，当客户端再次尝试获取sytle.js时就可以直接从缓存中获取到，不用再发请求了。
### HTTPS
HTTPS(全称：Hypertext Transfer Protocol over Secure Socket Layer)，是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL。端口号443。  
**有两种基本的加解密算法类型：**  
&emsp;对称加密：密钥只有一个，加密解密为同一个密码，且加解密速度快，典型的对称加密算法有DES、AES等。  
&emsp;非对称加密：密钥成对出现(且根据公钥无法推知私钥，根据私钥也无法推知公钥)，加密解密使用不同密钥(公钥加密需要私钥解密，私钥加密需要公钥解密)，相对对称加密速度较慢，典型的非对称加密算法有RSA、DSA等。  
**https的通信过程：**  
1. 浏览器基于https发送访问请求，客户端向服务器传输客户端的SSL协议版本号，支持的加密算法的种类，产生的随机数Key1及其他信息。
2. 服务器返回数字证书(公钥等信息，数字签名)。
3. 浏览器用内置的ca相匹配的公钥解密，并用数字摘要算法对数字证书中公钥等信息生成本地数字签名，并与数字证书中的数字签名匹配，确认数字证书的有效性。如有问题则提示风险。
4. 浏览器产生随机的对称密钥，并用server的公钥加密。
5. server用自己的私钥解密得到对称密钥。
6. 双方使用对称密钥通信。
### WebSocket
&emsp;HTML5开始提供的一种浏览器与服务器进行全双工通讯的网络技术，属于应用层协议。它基于TCP传输协议，并复用HTTP的握手通道，支持双向通信。
### Cookie和Session
Cookie和Session都为了用来保存状态信息，都是保存客户端状态的机制，它们都是为了解决HTTP无状态的问题而所做的努力。Session可以用Cookie来实现，也可以用URL回写的机制来实现。用Cookie来实现的Session可以认为是对Cookie更高级的应用。  
**Cookie和Session区别：**  
1. Cookie将状态保存在客户端，Session将状态保存在服务器端。
2. Cookies是服务器在本地机器上存储的小段文本并随每一个请求发送至同一个服务器。Cookie最早在RFC2109中实现，后续RFC2965做了增强。网络服务器用HTTP头向客户端发送cookies，在客户终端，浏览器解析这些cookies并将它们保存为一个本地文件，它会自动将同一服务器的任何请求缚上这些cookies。Session并没有在HTTP的协议中定义。
3. Session是针对每一个用户的，变量的值保存在服务器上，用一个sessionID来区分是哪个用户session变量,这个值是通过用户的浏览器在访问的时候返回给服务器，当客户禁用cookie时，这个值也可能设置为由get来返回给服务器。
4. 就安全性来说：当你访问一个使用session 的站点，同时在自己机子上建立一个cookie，建议在服务器端的SESSION机制更安全些.因为它不会任意读取客户存储的信息。
**Session机制：**  
Session机制是一种服务器端的机制，服务器使用一种类似于散列表的结构(也可能就是使用散列表)来保存信息。当程序需要为某个客户端的请求创建一个session的时候，服务器首先检查这个客户端的请求里是否已包含了一个session标识 - 称为 session id，如果已包含一个session id则说明以前已经为此客户端创建过session，服务器就按照session id把这个 session检索出来使用(如果检索不到，可能会新建一个)，如果客户端请求不包含session id，则为此客户端创建一个session并且生成一个与此session相关联的session id，session id的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个 session id将被在本次响应中返回给客户端保存。  
**Cookie的流程：**  
服务器在响应消息中用Set-Cookie头将Cookie的内容回送给客户端，客户端在新的请求中将相同的内容携带在Cookie头中发送给服务器。从而实现会话的保持。
### 中间人攻击
**SSL劫持攻击：**  
SSL劫持攻击即SSL证书欺骗攻击，攻击者为了获得HTTPS传输的明文数据，需要先将自己接入到客户端和目标网站之间；在传输过程中伪造服务器的证书，将服务器的公钥替换成自己的公钥，这样，中间人就可以得到明文传输带Key1、Key2和Pre-Master-Key，从而窃取客户端和服务端的通信数据。  
但是对于客户端来说，如果中间人伪造了证书，在校验证书过程中会提示证书错误，由用户选择继续操作还是返回，由于大多数用户的安全意识不强，会选择继续操作，此时，中间人就可以获取浏览器和服务器之间的通信数据。  
**SSL剥离攻击**   
这种攻击方式也需要将攻击者设置为中间人，之后见HTTPS范文替换为HTTP返回给浏览器，而中间人和服务器之间仍然保持HTTPS服务器。由于HTTP是明文传输的，所以中间人可以获取客户端和服务器传输数据